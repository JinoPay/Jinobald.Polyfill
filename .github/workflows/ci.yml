name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Ubuntu - .NET 6.0
  test-ubuntu-net60:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '6.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net6.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net6.0

  # Ubuntu - .NET 7.0
  test-ubuntu-net70:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '7.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net7.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net7.0

  # Ubuntu - .NET 8.0
  test-ubuntu-net80:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net8.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net8.0

  # Ubuntu - .NET 9.0
  test-ubuntu-net90:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net9.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net9.0

  # Ubuntu - .NET 10.0
  test-ubuntu-net100:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net10.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net10.0

  # macOS - .NET 6.0
  test-macos-net60:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '6.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net6.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net6.0

  # macOS - .NET 7.0
  test-macos-net70:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '7.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net7.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net7.0

  # macOS - .NET 8.0
  test-macos-net80:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net8.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net8.0

  # macOS - .NET 9.0
  test-macos-net90:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net9.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net9.0

  # macOS - .NET 10.0
  test-macos-net100:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net10.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net10.0

  # Windows - .NET 6.0
  test-windows-net60:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '6.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net6.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net6.0

  # Windows - .NET 7.0
  test-windows-net70:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '7.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net7.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net7.0

  # Windows - .NET 8.0
  test-windows-net80:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net8.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net8.0

  # Windows - .NET 9.0
  test-windows-net90:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net9.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net9.0

  # Windows - .NET 10.0
  test-windows-net100:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net10.0
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net10.0

  # Windows - .NET Framework 3.5, 4.0, 4.5
  # These are skipped in CI as GitHub Actions runners don't have the required targeting packs
  # The library still supports these frameworks - they must be tested locally
  #
  # test-windows-net35:
  #   runs-on: windows-2019
  #   steps:
  #   - uses: actions/checkout@v4
  #   - uses: actions/setup-dotnet@v4
  #     with:
  #       dotnet-version: '8.0.x'
  #   - run: dotnet restore
  #   - run: dotnet build --no-restore --configuration Release --framework net35
  #   - run: dotnet test --no-build --configuration Release --verbosity normal --framework net35
  #
  # test-windows-net40:
  #   runs-on: windows-2019
  #   steps:
  #   - uses: actions/checkout@v4
  #   - uses: actions/setup-dotnet@v4
  #     with:
  #       dotnet-version: '8.0.x'
  #   - run: dotnet restore
  #   - run: dotnet build --no-restore --configuration Release --framework net40
  #   - run: dotnet test --no-build --configuration Release --verbosity normal --framework net40
  #
  # test-windows-net45:
  #   runs-on: windows-2019
  #   steps:
  #   - uses: actions/checkout@v4
  #   - uses: actions/setup-dotnet@v4
  #     with:
  #       dotnet-version: '8.0.x'
  #   - run: dotnet restore
  #   - run: dotnet build --no-restore --configuration Release --framework net45
  #   - run: dotnet test --no-build --configuration Release --verbosity normal --framework net45

  # Windows - .NET Framework 4.5.1, 4.5.2, 4.6, 4.6.1
  # These are skipped in CI as GitHub Actions runners don't have reliable targeting packs
  # The library still supports these frameworks - they must be tested locally
  # Earliest testable .NET Framework version in CI is 4.6.2

  # Windows - .NET Framework 4.6.2
  test-windows-net462:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    - run: choco install netfx-4.6.2-devpack -y
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net462
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net462

  # Windows - .NET Framework 4.7.2
  test-windows-net472:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    - run: choco install netfx-4.7.2-devpack -y
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net472
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net472

  # Windows - .NET Framework 4.8.1
  test-windows-net481:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    - run: choco install netfx-4.8.1-devpack -y
    - run: dotnet restore
    - run: dotnet build --no-restore --configuration Release --framework net481
    - run: dotnet test --no-build --configuration Release --verbosity normal --framework net481
